<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>üåªVoice Cart</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Noto+Sans+Devanagari:wght@400;500;600&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
:root{
--y1:#F7C948;--y2:#E8A817;--y3:#D4911E;--br:#5D4037;--brd:#3E2723;
--gn:#6B8E23;--bg:#FFFDE7;--bgw:#FFF9E6;--wh:#fff;
--td:#3E2723;--tm:#6D4C41;--ts:#A1887F;
--dn:#E57373;--dnb:#FFEBEE;--ok:#66BB6A;--okb:#E8F5E9;
}
body{font-family:'Poppins','Noto Sans Devanagari',sans-serif;background:var(--bg);color:var(--td);min-height:100vh;overflow-x:hidden;position:relative}

/* ======= SUNFLOWER BACKGROUND ======= */
.sun-bg{position:fixed;top:0;left:0;right:0;bottom:0;z-index:0;pointer-events:none;overflow:hidden}

.sunflower{position:absolute;opacity:0.07}
.sunflower svg{width:100%;height:100%}

.sf1{width:200px;height:200px;top:-20px;left:-30px;animation:sway1 12s ease-in-out infinite}
.sf2{width:260px;height:260px;top:15%;right:-50px;animation:sway2 15s ease-in-out infinite}
.sf3{width:180px;height:180px;bottom:5%;left:-20px;animation:sway1 18s ease-in-out infinite 2s}
.sf4{width:150px;height:150px;top:50%;right:10px;animation:sway2 14s ease-in-out infinite 3s}
.sf5{width:220px;height:220px;bottom:25%;left:30%;animation:sway1 16s ease-in-out infinite 5s}
.sf6{width:170px;height:170px;top:35%;left:10%;animation:sway2 13s ease-in-out infinite 1s}

@keyframes sway1{0%,100%{transform:rotate(0deg) translateY(0)}25%{transform:rotate(5deg) translateY(-10px)}50%{transform:rotate(-3deg) translateY(5px)}75%{transform:rotate(4deg) translateY(-7px)}}
@keyframes sway2{0%,100%{transform:rotate(0deg) translateY(0)}25%{transform:rotate(-4deg) translateY(8px)}50%{transform:rotate(5deg) translateY(-6px)}75%{transform:rotate(-3deg) translateY(4px)}}

/* Dot pattern */
.dot-bg{position:fixed;top:0;left:0;right:0;bottom:0;z-index:0;pointer-events:none;
background-image:radial-gradient(circle,rgba(244,196,48,0.06) 1px,transparent 1px);background-size:24px 24px}

/* ======= MAIN CONTENT LAYER ======= */
.main-layer{position:relative;z-index:1}

/* ======= HEADER ======= */
.header{background:linear-gradient(135deg,#F7C948 0%,#E8A817 50%,#D4911E 100%);padding:18px 16px 30px;text-align:center;position:relative;overflow:hidden}
.header::before{content:'';position:absolute;top:-40%;left:-30%;width:160%;height:160%;background:radial-gradient(circle at 30% 40%,rgba(255,255,255,0.12) 0%,transparent 50%);pointer-events:none}
.header::after{content:'';position:absolute;bottom:-12px;left:-5%;right:-5%;height:24px;background:var(--bg);border-radius:50% 50% 0 0}
.header *{position:relative;z-index:1}
.header .logo{font-size:2.5rem;display:inline-block;animation:logop 3s ease-in-out infinite;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.1))}
@keyframes logop{0%,100%{transform:scale(1) rotate(0)}50%{transform:scale(1.1) rotate(10deg)}}
.header h1{font-size:1.5rem;color:#fff;font-weight:700;text-shadow:0 2px 4px rgba(0,0,0,0.1);margin:4px 0 2px}
.header p{color:rgba(255,255,255,0.88);font-size:0.75rem;font-weight:300}

/* ======= CONTAINER ======= */
.container{max-width:500px;margin:0 auto;padding:16px 12px 90px}

/* ======= CARD ======= */
.card{background:var(--wh);border-radius:16px;padding:14px;margin-bottom:12px;box-shadow:0 2px 14px rgba(244,196,48,0.13);border:1px solid rgba(244,196,48,0.08)}
.card-label{font-size:0.67rem;text-transform:uppercase;letter-spacing:1.2px;color:var(--ts);font-weight:600;margin-bottom:10px;display:flex;align-items:center;gap:6px}
.card-label::after{content:'';flex:1;height:1px;background:linear-gradient(to right,rgba(244,196,48,0.25),transparent)}

/* ======= LANGUAGE TOGGLE ======= */
.lang-row{display:flex;gap:6px}
.lang-btn{flex:1;padding:10px 8px;border:2px solid rgba(244,196,48,0.15);border-radius:12px;background:var(--bgw);cursor:pointer;font-family:inherit;font-size:0.82rem;color:var(--tm);transition:all 0.25s;text-align:center;font-weight:500}
.lang-btn:hover{border-color:var(--y1)}
.lang-btn.active{border-color:var(--y2);background:linear-gradient(135deg,var(--y1),var(--y2));color:#fff;box-shadow:0 3px 10px rgba(244,196,48,0.3)}

/* ======= CART TABS ======= */
.tabs-wrap{display:flex;gap:6px;align-items:center}
.tabs-scroll{display:flex;gap:6px;overflow-x:auto;flex:1;padding-bottom:3px;scrollbar-width:none}
.tabs-scroll::-webkit-scrollbar{display:none}
.tab-btn{padding:7px 14px;border-radius:20px;border:2px solid rgba(244,196,48,0.15);background:var(--bgw);cursor:pointer;font-family:inherit;font-size:0.72rem;color:var(--tm);transition:all 0.25s;white-space:nowrap;font-weight:500;display:flex;align-items:center;gap:5px;flex-shrink:0}
.tab-btn.active{background:linear-gradient(135deg,var(--y1),var(--y2));color:#fff;border-color:var(--y2)}
.tab-cnt{background:rgba(255,255,255,0.3);padding:1px 7px;border-radius:10px;font-size:0.6rem}
.tab-del{background:none;border:none;cursor:pointer;font-size:0.7rem;color:rgba(255,255,255,0.6);padding:0 1px;transition:0.2s}
.tab-btn.active .tab-del:hover{color:#fff}
.new-tab{padding:7px 12px;border-radius:20px;border:2px dashed rgba(244,196,48,0.35);background:transparent;cursor:pointer;font-size:0.9rem;color:var(--y2);transition:all 0.25s;flex-shrink:0}
.new-tab:hover{background:var(--bgw);border-color:var(--y2)}

/* ======= VOICE AREA ======= */
.voice-area{text-align:center}
.mic-wrap{position:relative;display:inline-block;margin:8px 0}
.mic-ring{position:absolute;inset:-8px;border-radius:50%;border:3px solid transparent;transition:0.3s}
.mic-ring.pulse{border-color:#E57373;animation:rpulse 1.5s ease-in-out infinite}
@keyframes rpulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.18);opacity:0.4}}
.mic-btn{width:64px;height:64px;border-radius:50%;border:none;background:linear-gradient(135deg,var(--y1),var(--y3));color:#fff;font-size:1.6rem;cursor:pointer;transition:all 0.3s;box-shadow:0 4px 16px rgba(244,196,48,0.35);position:relative;z-index:1}
.mic-btn:hover{transform:scale(1.06)}
.mic-btn:active{transform:scale(0.95)}
.mic-btn.active{background:linear-gradient(135deg,#EF5350,#C62828);box-shadow:0 4px 18px rgba(229,115,115,0.4)}
.voice-status{font-size:0.78rem;color:var(--ts);margin-top:6px;min-height:20px;transition:0.3s}
.voice-status.on{color:#E57373;font-weight:500}
.transcript{background:var(--bgw);border-radius:10px;padding:8px 12px;margin-top:8px;font-size:0.82rem;color:var(--tm);min-height:36px;display:flex;align-items:center;justify-content:center;border:1px dashed rgba(244,196,48,0.22);word-break:break-word}
.hints{display:flex;flex-wrap:wrap;gap:4px;justify-content:center;margin-top:10px}
.hint{background:var(--bgw);border:1px solid rgba(244,196,48,0.12);border-radius:16px;padding:3px 10px;font-size:0.63rem;color:var(--ts)}

/* ======= ADD ROW ======= */
.add-row{display:flex;gap:6px}
.inp{flex:1;padding:10px 14px;border:2px solid rgba(244,196,48,0.13);border-radius:10px;font-family:inherit;font-size:0.85rem;background:var(--bgw);color:var(--td);outline:none;transition:0.25s;min-width:0}
.inp:focus{border-color:var(--y1);box-shadow:0 0 0 3px rgba(244,196,48,0.1)}
.inp::placeholder{color:var(--ts)}
.inp-qty{width:54px;flex:none;text-align:center;padding:10px 4px}
.btn{padding:10px 16px;border:none;border-radius:10px;font-family:inherit;font-size:0.8rem;font-weight:600;cursor:pointer;transition:all 0.25s;white-space:nowrap}
.btn-sun{background:linear-gradient(135deg,var(--y1),var(--y3));color:#fff;box-shadow:0 2px 10px rgba(244,196,48,0.3)}
.btn-sun:hover{box-shadow:0 4px 14px rgba(244,196,48,0.4);transform:translateY(-1px)}
.btn-out{background:var(--wh);color:var(--br);border:2px solid rgba(244,196,48,0.2)}
.btn-out:hover{border-color:var(--y1);background:var(--bgw)}

/* ======= CART HEADER ======= */
.cart-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.cart-title{font-size:1rem;font-weight:600;display:flex;align-items:center;gap:7px}
.badge{background:linear-gradient(135deg,var(--y1),var(--y2));color:#fff;font-size:0.62rem;padding:2px 9px;border-radius:16px;font-weight:600}
.clear-btn{background:none;border:1px solid rgba(229,115,115,0.3);color:var(--dn);padding:5px 12px;border-radius:8px;font-family:inherit;font-size:0.68rem;cursor:pointer;transition:0.25s}
.clear-btn:hover{background:var(--dn);color:#fff;border-color:var(--dn)}

/* Search */
.search-wrap{position:relative;margin-bottom:10px}
.search-wrap .s-icon{position:absolute;left:11px;top:50%;transform:translateY(-50%);font-size:0.8rem;opacity:0.35}
.search-wrap .inp{width:100%;padding-left:34px;font-size:0.8rem;padding-top:8px;padding-bottom:8px}

/* ======= CART LIST ======= */
.cart-list{list-style:none}
.empty{text-align:center;padding:28px 10px;color:var(--ts)}
.empty .e-icon{font-size:2.8rem;margin-bottom:8px;display:block}
.empty p{font-size:0.8rem;line-height:1.5}

/* Cart Item */
.item{display:flex;align-items:center;gap:8px;padding:10px 9px;background:var(--bgw);border-radius:11px;margin-bottom:6px;border:1px solid rgba(244,196,48,0.07);animation:itemIn 0.35s ease;transition:all 0.25s}
.item:hover{box-shadow:0 2px 12px rgba(244,196,48,0.12)}
@keyframes itemIn{from{opacity:0;transform:translateY(-10px) scale(0.96)}to{opacity:1;transform:none}}
.item.out{animation:itemOut 0.35s ease forwards}
@keyframes itemOut{to{opacity:0;transform:translateX(30px) scale(0.94);height:0;padding:0;margin:0;overflow:hidden}}
.item.done{opacity:0.45}
.item.done .i-name{text-decoration:line-through}
.i-check{width:18px;height:18px;accent-color:var(--y2);cursor:pointer;flex-shrink:0}
.i-num{width:24px;height:24px;border-radius:50%;background:linear-gradient(135deg,var(--y1),var(--y2));color:#fff;font-size:0.62rem;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.i-info{flex:1;min-width:0}
.i-name{font-size:0.85rem;font-weight:500;color:var(--td);word-break:break-word;line-height:1.3}
.i-time{font-size:0.6rem;color:var(--ts);margin-top:2px}
.i-qty{display:flex;align-items:center;gap:4px;flex-shrink:0}
.q-btn{width:24px;height:24px;border-radius:6px;border:1px solid rgba(244,196,48,0.22);background:var(--wh);color:var(--br);font-size:0.8rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:0.2s}
.q-btn:hover{background:var(--y1);color:#fff;border-color:var(--y1)}
.q-val{font-weight:600;font-size:0.8rem;min-width:18px;text-align:center}
.i-acts{display:flex;gap:3px;flex-shrink:0}
.a-btn{width:28px;height:28px;border-radius:7px;border:none;cursor:pointer;font-size:0.7rem;display:flex;align-items:center;justify-content:center;transition:0.2s}
.a-edit{background:var(--okb);color:var(--gn)}
.a-edit:hover{background:var(--gn);color:#fff}
.a-del{background:var(--dnb);color:var(--dn)}
.a-del:hover{background:var(--dn);color:#fff}

/* ======= SUMMARY ======= */
.s-row{display:flex;justify-content:space-between;padding:4px 0;font-size:0.8rem;color:var(--tm)}
.s-row.total{border-top:2px dashed rgba(244,196,48,0.22);padding-top:8px;margin-top:4px;font-weight:600;font-size:0.88rem;color:var(--td)}

/* ======= ACTION BUTTONS ======= */
.act-bar{display:flex;gap:6px;flex-wrap:wrap}
.act-bar .btn{flex:1;text-align:center;font-size:0.7rem;padding:9px 6px;min-width:calc(33% - 5px)}

/* ======= MODAL ======= */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.3);backdrop-filter:blur(4px);z-index:500;display:none;align-items:center;justify-content:center;padding:16px}
.overlay.open{display:flex}
.modal{background:var(--wh);border-radius:18px;padding:22px;width:100%;max-width:360px;box-shadow:0 10px 30px rgba(0,0,0,0.13);animation:modIn 0.3s ease}
@keyframes modIn{from{opacity:0;transform:scale(0.9)}to{opacity:1;transform:none}}
.modal h3{font-size:1rem;text-align:center;margin-bottom:14px;color:var(--td)}
.modal .inp{width:100%;margin-bottom:10px}
.mod-btns{display:flex;gap:8px;margin-top:6px}
.mod-btns .btn{flex:1}
.btn-gray{background:var(--bgw);color:var(--tm)}
.btn-gray:hover{background:#eee}

/* ======= TOAST ======= */
.toast-wrap{position:fixed;top:14px;left:50%;transform:translateX(-50%);z-index:1000;display:flex;flex-direction:column;align-items:center;gap:6px;width:90%;max-width:340px;pointer-events:none}
.toast{padding:10px 18px;border-radius:12px;font-size:0.8rem;font-family:inherit;color:#fff;box-shadow:0 4px 12px rgba(0,0,0,0.13);animation:tIn 0.3s ease,tOut 0.3s ease 2.5s forwards;text-align:center;width:100%;pointer-events:auto}
.toast.s{background:linear-gradient(135deg,#66BB6A,#43A047)}
.toast.e{background:linear-gradient(135deg,#EF5350,#D32F2F)}
.toast.i{background:linear-gradient(135deg,var(--y1),var(--y3))}
@keyframes tIn{from{opacity:0;transform:translateY(-18px)}to{opacity:1;transform:none}}
@keyframes tOut{to{opacity:0;transform:translateY(-10px)}}

.footer{text-align:center;padding:16px;font-size:0.65rem;color:var(--ts)}

/* ======= RESPONSIVE ======= */
@media(max-width:360px){
.container{padding:8px 6px 70px}
.card{padding:10px}
.header h1{font-size:1.2rem}
.mic-btn{width:52px;height:52px;font-size:1.3rem}
.lang-btn{font-size:0.75rem;padding:8px 5px}
.item{gap:5px;padding:8px 6px}
.i-name{font-size:0.78rem}
.i-acts{flex-direction:column;gap:2px}
.a-btn{width:24px;height:24px;font-size:0.6rem}
.q-btn{width:22px;height:22px}
.act-bar .btn{min-width:calc(50% - 4px)}
}
@media(min-width:361px) and (max-width:430px){
.container{padding:10px 8px 80px}
.card{padding:12px}
}
@media print{
.voice-area,.add-row,.act-bar,.lang-row,.tabs-wrap,.new-tab,.i-acts,.i-qty,.clear-btn,.i-check,.search-wrap,.hints,.sun-bg,.dot-bg{display:none!important}
body{background:#fff!important}
.header{background:#fff!important}
.header h1,.header p{color:#333!important;text-shadow:none!important}
.card{box-shadow:none!important;border:1px solid #ddd!important}
}
</style>
</head>
<body>

<!-- ======= SUNFLOWER BACKGROUND (SVG) ======= -->
<div class="sun-bg">
<div class="sunflower sf1"><svg viewBox="0 0 200 200"><g transform="translate(100,100)"><g fill="#F7C948"><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(0)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(30)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(60)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(90)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(120)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(150)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(180)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(210)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(240)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(270)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(300)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(330)"/></g><circle r="26" fill="#5D4037"/><circle r="18" fill="#3E2723"/></g></svg></div>
<div class="sunflower sf2"><svg viewBox="0 0 200 200"><g transform="translate(100,100)"><g fill="#E8A817"><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(0)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(30)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(60)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(90)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(120)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(150)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(180)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(210)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(240)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(270)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(300)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(330)"/></g><circle r="26" fill="#5D4037"/><circle r="18" fill="#3E2723"/></g></svg></div>
<div class="sunflower sf3"><svg viewBox="0 0 200 200"><g transform="translate(100,100)"><g fill="#F7C948"><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(0)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(30)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(60)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(90)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(120)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(150)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(180)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(210)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(240)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(270)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(300)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(330)"/></g><circle r="26" fill="#5D4037"/><circle r="18" fill="#3E2723"/></g></svg></div>
<div class="sunflower sf4"><svg viewBox="0 0 200 200"><g transform="translate(100,100)"><g fill="#D4911E"><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(0)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(30)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(60)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(90)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(120)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(150)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(180)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(210)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(240)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(270)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(300)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(330)"/></g><circle r="26" fill="#5D4037"/><circle r="18" fill="#3E2723"/></g></svg></div>
<div class="sunflower sf5"><svg viewBox="0 0 200 200"><g transform="translate(100,100)"><g fill="#F7C948"><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(15)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(45)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(75)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(105)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(135)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(165)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(195)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(225)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(255)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(285)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(315)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(345)"/></g><circle r="26" fill="#5D4037"/><circle r="18" fill="#3E2723"/></g></svg></div>
<div class="sunflower sf6"><svg viewBox="0 0 200 200"><g transform="translate(100,100)"><g fill="#E8A817"><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(0)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(36)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(72)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(108)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(144)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(180)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(216)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(252)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(288)"/><ellipse cx="0" cy="-52" rx="16" ry="42" transform="rotate(324)"/></g><circle r="26" fill="#5D4037"/><circle r="18" fill="#3E2723"/></g></svg></div>
</div>
<div class="dot-bg"></div>

<!-- TOAST -->
<div class="toast-wrap" id="toasts"></div>

<!-- EDIT MODAL -->
<div class="overlay" id="editOv" onclick="if(event.target===this)closeEdit()">
<div class="modal">
<h3 id="editTitle">‚úèÔ∏è Edit Item</h3>
<input class="inp" id="editName" placeholder="Item name">
<input class="inp inp-qty" id="editQty" type="number" min="1" value="1" style="width:100%">
<div class="mod-btns">
<button class="btn btn-gray" onclick="closeEdit()">Cancel</button>
<button class="btn btn-sun" onclick="saveEdit()">Save</button>
</div>
</div>
</div>

<!-- NEW CART MODAL -->
<div class="overlay" id="newOv" onclick="if(event.target===this)this.classList.remove('open')">
<div class="modal">
<h3>üìÇ New Cart</h3>
<input class="inp" id="newCartName" placeholder="Cart name..." onkeydown="if(event.key==='Enter')createCart()">
<div class="mod-btns">
<button class="btn btn-gray" onclick="document.getElementById('newOv').classList.remove('open')">Cancel</button>
<button class="btn btn-sun" onclick="createCart()">Create</button>
</div>
</div>
</div>

<!-- MAIN CONTENT -->
<div class="main-layer">

<!-- HEADER -->
<div class="header">
<span class="logo">üåª</span>
<h1>Voice Cart</h1>
<p id="subText">Your smart shopping companion</p>
</div>

<div class="container">

<!-- LANGUAGE -->
<div class="card">
<div class="card-label" id="langLbl">üåê Display Language</div>
<div class="lang-row">
<button class="lang-btn active" data-lang="en" onclick="setLang('en')">üá¨üáß English</button>
<button class="lang-btn" data-lang="hi" onclick="setLang('hi')">üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
</div>
</div>

<!-- CART TABS -->
<div class="card">
<div class="card-label" id="cartLbl">üìÇ My Carts</div>
<div class="tabs-wrap">
<div class="tabs-scroll" id="tabsArea"></div>
<button class="new-tab" onclick="openNewCart()" title="New Cart">Ôºã</button>
</div>
</div>

<!-- VOICE -->
<div class="card voice-area">
<div class="card-label" id="voiceLbl">üé§ Voice Command</div>
<div class="mic-wrap">
<div class="mic-ring" id="micRing"></div>
<button class="mic-btn" id="micBtn" onclick="toggleMic()">üéôÔ∏è</button>
</div>
<div class="voice-status" id="vStatus">Tap mic and speak</div>
<div class="transcript" id="vTranscript">Waiting for your voice...</div>
<div class="hints" id="hintArea">
<span class="hint">üó£Ô∏è "Add milk"</span>
<span class="hint">üó£Ô∏è "Remove rice"</span>
<span class="hint">üó£Ô∏è "‡§¶‡•Ç‡§ß ‡§ú‡•ã‡§°‡§º‡•ã"</span>
<span class="hint">üó£Ô∏è "‡§ö‡§æ‡§µ‡§≤ ‡§π‡§ü‡§æ‡§ì"</span>
</div>
</div>

<!-- MANUAL ADD -->
<div class="card">
<div class="card-label" id="addLbl">‚ûï Add Manually</div>
<div class="add-row">
<input class="inp" id="manInp" placeholder="Item name..." onkeydown="if(event.key==='Enter')manualAdd()">
<input class="inp inp-qty" id="manQty" type="number" value="1" min="1">
<button class="btn btn-sun" onclick="manualAdd()" id="addBtnTxt">Add</button>
</div>
</div>

<!-- CART LIST -->
<div class="card" id="cartCard">
<div class="cart-head">
<div class="cart-title">üõí <span id="cartNameEl">My Cart</span> <span class="badge" id="countEl">0</span></div>
<button class="clear-btn" onclick="clearAll()" id="clearTxt">Clear All</button>
</div>
<div class="search-wrap"><span class="s-icon">üîç</span><input class="inp" id="searchInp" placeholder="Search..." oninput="renderList()"></div>
<ul class="cart-list" id="listEl"></ul>
</div>

<!-- SUMMARY -->
<div class="card" id="sumCard" style="display:none">
<div class="card-label" id="sumLbl">üìä Summary</div>
<div class="s-row"><span id="sl1">Total Items</span><span id="sv1">0</span></div>
<div class="s-row"><span id="sl2">Total Qty</span><span id="sv2">0</span></div>
<div class="s-row"><span id="sl3">Checked</span><span id="sv3">0</span></div>
<div class="s-row total"><span id="sl4">Remaining</span><span id="sv4">0</span></div>
</div>

<!-- ACTIONS -->
<div class="act-bar">
<button class="btn btn-out" onclick="copyList()">üìã Copy</button>
<button class="btn btn-out" onclick="window.print()">üñ®Ô∏è Print</button>
<button class="btn btn-out" onclick="shareList()">üì§ Share</button>
</div>

<div class="footer">üåª Sunflower Voice Cart ‚Äî Made with ‚ù§Ô∏è</div>

</div>
</div>

<script>
// ============= WORD DICTIONARY =============
var DICT = {
  // Hindi ‚Üí English
  '‡§¶‡•Ç‡§ß':'milk','‡§Ö‡§Ç‡§°‡•á':'eggs','‡§Ö‡§Ç‡§°‡§æ':'egg','‡§ö‡§æ‡§µ‡§≤':'rice','‡§¶‡§æ‡§≤':'dal',
  '‡§Ü‡§ü‡§æ':'flour','‡§ö‡•Ä‡§®‡•Ä':'sugar','‡§®‡§Æ‡§ï':'salt','‡§§‡•á‡§≤':'oil',
  '‡§Æ‡§ï‡•ç‡§ñ‡§®':'butter','‡§™‡§®‡•Ä‡§∞':'paneer','‡§¨‡•ç‡§∞‡•á‡§°':'bread','‡§∞‡•ã‡§ü‡•Ä':'roti',
  '‡§ü‡§Æ‡§æ‡§ü‡§∞':'tomato','‡§Ü‡§≤‡•Ç':'potato','‡§™‡•ç‡§Ø‡§æ‡§ú':'onion','‡§™‡•ç‡§Ø‡§æ‡§ú‡§º':'onion',
  '‡§≤‡§π‡§∏‡•Å‡§®':'garlic','‡§Ö‡§¶‡§∞‡§ï':'ginger','‡§Æ‡§ø‡§∞‡•ç‡§ö':'chilli','‡§π‡§≤‡•ç‡§¶‡•Ä':'turmeric',
  '‡§ß‡§®‡§ø‡§Ø‡§æ':'coriander','‡§ú‡•Ä‡§∞‡§æ':'cumin','‡§ö‡§æ‡§Ø':'tea','‡§ï‡•â‡§´‡•Ä':'coffee',
  '‡§™‡§æ‡§®‡•Ä':'water','‡§ú‡•Ç‡§∏':'juice','‡§∏‡•á‡§¨':'apple','‡§ï‡•á‡§≤‡§æ':'banana',
  '‡§∏‡§Ç‡§§‡§∞‡§æ':'orange','‡§Ö‡§Ç‡§ó‡•Ç‡§∞':'grapes','‡§Ü‡§Æ':'mango','‡§¶‡§π‡•Ä':'curd',
  '‡§ò‡•Ä':'ghee','‡§∏‡§æ‡§¨‡•Å‡§®':'soap','‡§¨‡§ø‡§∏‡•ç‡§ï‡•Å‡§ü':'biscuit','‡§ö‡•â‡§ï‡§≤‡•á‡§ü':'chocolate',
  '‡§®‡•Ç‡§°‡§≤‡•ç‡§∏':'noodles','‡§ó‡•ã‡§≠‡•Ä':'cauliflower','‡§™‡§æ‡§≤‡§ï':'spinach','‡§Æ‡§ü‡§∞':'peas',
  '‡§ó‡§æ‡§ú‡§∞':'carrot','‡§ñ‡•Ä‡§∞‡§æ':'cucumber','‡§Æ‡•à‡§¶‡§æ':'maida','‡§¨‡•á‡§∏‡§®':'besan',
  '‡§∏‡•Ç‡§ú‡•Ä':'suji','‡§ï‡•á‡§ö‡§™':'ketchup','‡§Ö‡§ö‡§æ‡§∞':'pickle','‡§∂‡•à‡§Æ‡•ç‡§™‡•Ç':'shampoo',
  '‡§Æ‡•Ç‡§≤‡•Ä':'radish','‡§≠‡§ø‡§Ç‡§°‡•Ä':'okra','‡§¨‡•à‡§Ç‡§ó‡§®':'brinjal','‡§∏‡§∞‡§∏‡•ã‡§Ç':'mustard',
  '‡§™‡§æ‡§™‡§°‡§º':'papad','‡§™‡§æ‡§∏‡•ç‡§§‡§æ':'pasta','‡§ö‡§ø‡§ï‡§®':'chicken','‡§Æ‡§õ‡§≤‡•Ä':'fish',
  '‡§ü‡•Ç‡§•‡§™‡•á‡§∏‡•ç‡§ü':'toothpaste','‡§∂‡§ï‡•ç‡§ï‡§∞':'sugar','‡§∏‡•â‡§∏':'sauce',
  // English ‚Üí Hindi
  'milk':'‡§¶‡•Ç‡§ß','eggs':'‡§Ö‡§Ç‡§°‡•á','egg':'‡§Ö‡§Ç‡§°‡§æ','rice':'‡§ö‡§æ‡§µ‡§≤','dal':'‡§¶‡§æ‡§≤',
  'flour':'‡§Ü‡§ü‡§æ','sugar':'‡§ö‡•Ä‡§®‡•Ä','salt':'‡§®‡§Æ‡§ï','oil':'‡§§‡•á‡§≤',
  'butter':'‡§Æ‡§ï‡•ç‡§ñ‡§®','paneer':'‡§™‡§®‡•Ä‡§∞','bread':'‡§¨‡•ç‡§∞‡•á‡§°','roti':'‡§∞‡•ã‡§ü‡•Ä',
  'tomato':'‡§ü‡§Æ‡§æ‡§ü‡§∞','potato':'‡§Ü‡§≤‡•Ç','onion':'‡§™‡•ç‡§Ø‡§æ‡§ú','garlic':'‡§≤‡§π‡§∏‡•Å‡§®',
  'ginger':'‡§Ö‡§¶‡§∞‡§ï','chilli':'‡§Æ‡§ø‡§∞‡•ç‡§ö','turmeric':'‡§π‡§≤‡•ç‡§¶‡•Ä','coriander':'‡§ß‡§®‡§ø‡§Ø‡§æ',
  'cumin':'‡§ú‡•Ä‡§∞‡§æ','tea':'‡§ö‡§æ‡§Ø','coffee':'‡§ï‡•â‡§´‡•Ä','water':'‡§™‡§æ‡§®‡•Ä',
  'juice':'‡§ú‡•Ç‡§∏','apple':'‡§∏‡•á‡§¨','banana':'‡§ï‡•á‡§≤‡§æ','orange':'‡§∏‡§Ç‡§§‡§∞‡§æ',
  'grapes':'‡§Ö‡§Ç‡§ó‡•Ç‡§∞','mango':'‡§Ü‡§Æ','curd':'‡§¶‡§π‡•Ä','yogurt':'‡§¶‡§π‡•Ä',
  'ghee':'‡§ò‡•Ä','soap':'‡§∏‡§æ‡§¨‡•Å‡§®','biscuit':'‡§¨‡§ø‡§∏‡•ç‡§ï‡•Å‡§ü','chocolate':'‡§ö‡•â‡§ï‡§≤‡•á‡§ü',
  'noodles':'‡§®‡•Ç‡§°‡§≤‡•ç‡§∏','cauliflower':'‡§ó‡•ã‡§≠‡•Ä','spinach':'‡§™‡§æ‡§≤‡§ï','peas':'‡§Æ‡§ü‡§∞',
  'carrot':'‡§ó‡§æ‡§ú‡§∞','cucumber':'‡§ñ‡•Ä‡§∞‡§æ','maida':'‡§Æ‡•à‡§¶‡§æ','besan':'‡§¨‡•á‡§∏‡§®',
  'suji':'‡§∏‡•Ç‡§ú‡•Ä','ketchup':'‡§ï‡•á‡§ö‡§™','pickle':'‡§Ö‡§ö‡§æ‡§∞','shampoo':'‡§∂‡•à‡§Æ‡•ç‡§™‡•Ç',
  'radish':'‡§Æ‡•Ç‡§≤‡•Ä','okra':'‡§≠‡§ø‡§Ç‡§°‡•Ä','brinjal':'‡§¨‡•à‡§Ç‡§ó‡§®','mustard':'‡§∏‡§∞‡§∏‡•ã‡§Ç',
  'papad':'‡§™‡§æ‡§™‡§°‡§º','pasta':'‡§™‡§æ‡§∏‡•ç‡§§‡§æ','chicken':'‡§ö‡§ø‡§ï‡§®','fish':'‡§Æ‡§õ‡§≤‡•Ä',
  'toothpaste':'‡§ü‡•Ç‡§•‡§™‡•á‡§∏‡•ç‡§ü','sauce':'‡§∏‡•â‡§∏','cheese':'‡§™‡§®‡•Ä‡§∞',
  'lemon':'‡§®‡•Ä‡§Ç‡§¨‡•Ç','‡§®‡•Ä‡§Ç‡§¨‡•Ç':'lemon','coconut':'‡§®‡§æ‡§∞‡§ø‡§Ø‡§≤','‡§®‡§æ‡§∞‡§ø‡§Ø‡§≤':'coconut',
  'mushroom':'‡§Æ‡§∂‡§∞‡•Ç‡§Æ','‡§Æ‡§∂‡§∞‡•Ç‡§Æ':'mushroom','corn':'‡§Æ‡§ï‡•ç‡§ï‡§æ','‡§Æ‡§ï‡•ç‡§ï‡§æ':'corn',
  'honey':'‡§∂‡§π‡§¶','‡§∂‡§π‡§¶':'honey','jam':'‡§ú‡•à‡§Æ','‡§ú‡•à‡§Æ':'jam',
  'chips':'‡§ö‡§ø‡§™‡•ç‡§∏','‡§ö‡§ø‡§™‡•ç‡§∏':'chips','biscuits':'‡§¨‡§ø‡§∏‡•ç‡§ï‡•Å‡§ü',
  'ice cream':'‡§Ü‡§á‡§∏‡§ï‡•ç‡§∞‡•Ä‡§Æ','‡§Ü‡§á‡§∏‡§ï‡•ç‡§∞‡•Ä‡§Æ':'ice cream',
  'dosa':'‡§°‡•ã‡§∏‡§æ','‡§°‡•ã‡§∏‡§æ':'dosa','idli':'‡§á‡§°‡§≤‡•Ä','‡§á‡§°‡§≤‡•Ä':'idli',
  'sambar':'‡§∏‡§æ‡§Ç‡§≠‡§∞','‡§∏‡§æ‡§Ç‡§≠‡§∞':'sambar'
};

function isHindi(text) {
  return /[\u0900-\u097F]/.test(text);
}

// Convert spoken text to selected display language
function convertText(rawText, targetLang) {
  if (!rawText || !rawText.trim()) return rawText;
  var words = rawText.trim().split(/\s+/);
  var converted = words.map(function(word) {
    var lower = word.toLowerCase();
    if (targetLang === 'en') {
      // Want English output
      if (isHindi(word)) {
        // Word is Hindi, convert to English
        return DICT[word] || word;
      } else {
        // Already English
        return word;
      }
    } else {
      // Want Hindi output
      if (isHindi(word)) {
        // Already Hindi
        return word;
      } else {
        // Word is English, convert to Hindi
        return DICT[lower] || word;
      }
    }
  });
  return converted.join(' ');
}

// ============= STATE =============
var carts = JSON.parse(localStorage.getItem('sfc_data')) || [{name:'My Cart',items:[]}];
var activeIdx = parseInt(localStorage.getItem('sfc_idx')) || 0;
var lang = localStorage.getItem('sfc_lang') || 'en';
var editingIdx = -1;
var recognition = null;
var isListening = false;

if (activeIdx >= carts.length) activeIdx = 0;

function save() {
  localStorage.setItem('sfc_data', JSON.stringify(carts));
  localStorage.setItem('sfc_idx', activeIdx);
  localStorage.setItem('sfc_lang', lang);
}

function getCart() { return carts[activeIdx]; }
function getItems() { return getCart().items; }

// ============= TOAST =============
function toast(msg, type) {
  type = type || 'i';
  var el = document.createElement('div');
  el.className = 'toast ' + type;
  el.textContent = msg;
  document.getElementById('toasts').appendChild(el);
  setTimeout(function() { if (el.parentNode) el.remove(); }, 3000);
}

// ============= LANGUAGE =============
var UI_TEXT = {
  en: {
    sub:'Your smart shopping companion',
    vTip:'Tap mic ‚Äî say "Add milk" or "Remove rice"',
    wait:'Waiting for your voice...',
    lis:'üî¥ Listening... speak now!',
    addL:'‚ûï Add Manually', ph:'Item name...', addB:'Add',
    clr:'Clear All', srch:'Search...', cartL:'üìÇ My Carts', voiceL:'üé§ Voice Command',
    empty:'Your cart is empty! Add items using voice or type below.',
    sumL:'üìä Summary', l1:'Total Items', l2:'Total Qty', l3:'Checked', l4:'Remaining',
    editT:'‚úèÔ∏è Edit Item',
    tAdd:'added to cart!', tRem:'removed!', tClr:'Cart cleared!',
    tNf:'not found in cart', tCp:'List copied!', tEmp:'Cart is empty!',
    noSp:'Speech not supported in this browser', langL:'üåê Display Language'
  },
  hi: {
    sub:'‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§∂‡•â‡§™‡§ø‡§Ç‡§ó ‡§∏‡§æ‡§•‡•Ä',
    vTip:'‡§Æ‡§æ‡§á‡§ï ‡§¶‡§¨‡§æ‡§è‡§Å ‚Äî "‡§¶‡•Ç‡§ß ‡§ú‡•ã‡§°‡§º‡•ã" ‡§Ø‡§æ "‡§ö‡§æ‡§µ‡§≤ ‡§π‡§ü‡§æ‡§ì" ‡§¨‡•ã‡§≤‡•á‡§Ç',
    wait:'‡§Ü‡§™‡§ï‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§ï‡§æ ‡§á‡§Ç‡§§‡§ú‡§º‡§æ‡§∞...',
    lis:'üî¥ ‡§∏‡•Å‡§® ‡§∞‡§π‡§æ ‡§π‡•à... ‡§Ö‡§¨ ‡§¨‡•ã‡§≤‡•á‡§Ç!',
    addL:'‚ûï ‡§Æ‡•à‡§®‡•ç‡§Ø‡•Å‡§Ö‡§≤ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç', ph:'‡§Ü‡§á‡§ü‡§Æ ‡§ï‡§æ ‡§®‡§æ‡§Æ...', addB:'‡§ú‡•ã‡§°‡§º‡•á‡§Ç',
    clr:'‡§∏‡§¨ ‡§π‡§ü‡§æ‡§ì', srch:'‡§ñ‡•ã‡§ú‡•á‡§Ç...', cartL:'üìÇ ‡§Æ‡•á‡§∞‡•á ‡§ï‡§æ‡§∞‡•ç‡§ü', voiceL:'üé§ ‡§µ‡•â‡§á‡§∏ ‡§ï‡§Æ‡§æ‡§Ç‡§°',
    empty:'‡§ï‡§æ‡§∞‡•ç‡§ü ‡§ñ‡§æ‡§≤‡•Ä ‡§π‡•à! ‡§µ‡•â‡§á‡§∏ ‡§Ø‡§æ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡§ï‡•á ‡§Ü‡§á‡§ü‡§Æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç‡•§',
    sumL:'üìä ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂', l1:'‡§ï‡•Å‡§≤ ‡§Ü‡§á‡§ü‡§Æ', l2:'‡§ï‡•Å‡§≤ ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ', l3:'‡§ö‡•á‡§ï ‡§ï‡§ø‡§Ø‡§æ', l4:'‡§¨‡§æ‡§ï‡•Ä',
    editT:'‚úèÔ∏è ‡§Ü‡§á‡§ü‡§Æ ‡§è‡§°‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç',
    tAdd:'‡§ï‡§æ‡§∞‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡§æ!', tRem:'‡§π‡§ü‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ!', tClr:'‡§ï‡§æ‡§∞‡•ç‡§ü ‡§∏‡§æ‡§´‡§º!',
    tNf:'‡§ï‡§æ‡§∞‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ', tCp:'‡§≤‡§ø‡§∏‡•ç‡§ü ‡§ï‡•â‡§™‡•Ä ‡§π‡•Å‡§à!', tEmp:'‡§ï‡§æ‡§∞‡•ç‡§ü ‡§ñ‡§æ‡§≤‡•Ä ‡§π‡•à!',
    noSp:'‡§∏‡•ç‡§™‡•Ä‡§ö ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à', langL:'üåê ‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç'
  }
};

function tx(key) { return (UI_TEXT[lang] && UI_TEXT[lang][key]) || UI_TEXT.en[key] || ''; }

function setLang(l) {
  lang = l;
  save();
  document.querySelectorAll('.lang-btn').forEach(function(b) {
    b.classList.toggle('active', b.getAttribute('data-lang') === l);
  });
  document.getElementById('subText').textContent = tx('sub');
  document.getElementById('vStatus').textContent = tx('vTip');
  document.getElementById('vTranscript').textContent = tx('wait');
  document.getElementById('addLbl').textContent = tx('addL');
  document.getElementById('manInp').placeholder = tx('ph');
  document.getElementById('addBtnTxt').textContent = tx('addB');
  document.getElementById('clearTxt').textContent = tx('clr');
  document.getElementById('searchInp').placeholder = tx('srch');
  document.getElementById('cartLbl').textContent = tx('cartL');
  document.getElementById('voiceLbl').textContent = tx('voiceL');
  document.getElementById('sumLbl').textContent = tx('sumL');
  document.getElementById('sl1').textContent = tx('l1');
  document.getElementById('sl2').textContent = tx('l2');
  document.getElementById('sl3').textContent = tx('l3');
  document.getElementById('sl4').textContent = tx('l4');
  document.getElementById('editTitle').textContent = tx('editT');
  document.getElementById('langLbl').textContent = tx('langL');
  renderList();
}

// ============= CART TABS =============
function renderTabs() {
  var area = document.getElementById('tabsArea');
  area.innerHTML = '';
  carts.forEach(function(c, i) {
    var btn = document.createElement('button');
    btn.className = 'tab-btn' + (i === activeIdx ? ' active' : '');
    var cnt = c.items.length;
    btn.innerHTML = '<span>' + escHtml(c.name) + '</span><span class="tab-cnt">' + cnt + '</span>';
    if (carts.length > 1) {
      var x = document.createElement('button');
      x.className = 'tab-del';
      x.textContent = '√ó';
      x.onclick = function(e) { e.stopPropagation(); deleteCart(i); };
      btn.appendChild(x);
    }
    btn.onclick = function() { activeIdx = i; save(); renderTabs(); renderList(); document.getElementById('cartNameEl').textContent = getCart().name; };
    area.appendChild(btn);
  });
  document.getElementById('cartNameEl').textContent = getCart().name;
}

function openNewCart() {
  document.getElementById('newCartName').value = '';
  document.getElementById('newOv').classList.add('open');
  setTimeout(function() { document.getElementById('newCartName').focus(); }, 100);
}

function createCart() {
  var name = document.getElementById('newCartName').value.trim() || ('Cart ' + (carts.length + 1));
  carts.push({name: name, items: []});
  activeIdx = carts.length - 1;
  save();
  document.getElementById('newOv').classList.remove('open');
  renderTabs();
  renderList();
  toast('üõí ' + name + ' created!', 's');
}

function deleteCart(i) {
  if (carts.length <= 1) { toast('Need at least 1 cart', 'e'); return; }
  if (!confirm('Delete "' + carts[i].name + '"?')) return;
  var nm = carts[i].name;
  carts.splice(i, 1);
  if (activeIdx >= carts.length) activeIdx = carts.length - 1;
  save(); renderTabs(); renderList();
  toast(nm + ' deleted', 'e');
}

// ============= CART OPERATIONS =============
function addItem(rawName, qty) {
  rawName = rawName.trim();
  if (!rawName) return;
  qty = qty || 1;

  // Convert to display language
  var displayName = convertText(rawName, lang);
  if (!displayName.trim()) displayName = rawName;

  var items = getItems();
  var existIdx = -1;
  for (var i = 0; i < items.length; i++) {
    if (items[i].name.toLowerCase() === displayName.toLowerCase()) {
      existIdx = i; break;
    }
  }

  if (existIdx > -1) {
    items[existIdx].qty += qty;
    toast(displayName + ' ‚Äî ' + tx('tAdd') + ' (x' + items[existIdx].qty + ')', 's');
  } else {
    items.push({
      name: displayName,
      qty: qty,
      checked: false,
      time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})
    });
    toast(displayName + ' ' + tx('tAdd'), 's');
  }
  save(); renderTabs(); renderList();
}

function removeItem(rawName) {
  rawName = rawName.trim();
  if (!rawName) return;

  var displayName = convertText(rawName, lang);
  var items = getItems();
  var idx = -1;

  // Try display name match
  for (var i = 0; i < items.length; i++) {
    if (items[i].name.toLowerCase() === displayName.toLowerCase()) { idx = i; break; }
  }
  // Try raw name match
  if (idx === -1) {
    for (var i = 0; i < items.length; i++) {
      if (items[i].name.toLowerCase() === rawName.toLowerCase()) { idx = i; break; }
    }
  }
  // Try reverse conversion match
  if (idx === -1) {
    var altLang = (lang === 'en') ? 'hi' : 'en';
    var altName = convertText(rawName, altLang);
    for (var i = 0; i < items.length; i++) {
      if (items[i].name.toLowerCase() === altName.toLowerCase()) { idx = i; break; }
    }
  }
  // Partial match
  if (idx === -1) {
    for (var i = 0; i < items.length; i++) {
      if (items[i].name.toLowerCase().includes(displayName.toLowerCase()) ||
          items[i].name.toLowerCase().includes(rawName.toLowerCase())) { idx = i; break; }
    }
  }

  if (idx > -1) {
    var nm = items[idx].name;
    var els = document.querySelectorAll('.item');
    if (els[idx]) {
      els[idx].classList.add('out');
      setTimeout(function() { items.splice(idx, 1); save(); renderTabs(); renderList(); }, 350);
    } else {
      items.splice(idx, 1); save(); renderTabs(); renderList();
    }
    toast(nm + ' ' + tx('tRem'), 'e');
  } else {
    toast('"' + rawName + '" ' + tx('tNf'), 'e');
  }
}

function removeByIdx(idx) {
  var items = getItems();
  var nm = items[idx].name;
  var els = document.querySelectorAll('.item');
  if (els[idx]) {
    els[idx].classList.add('out');
    setTimeout(function() { items.splice(idx, 1); save(); renderTabs(); renderList(); }, 350);
  } else {
    items.splice(idx, 1); save(); renderTabs(); renderList();
  }
  toast(nm + ' ' + tx('tRem'), 'e');
}

function changeQty(idx, delta) {
  var items = getItems();
  items[idx].qty += delta;
  if (items[idx].qty <= 0) { removeByIdx(idx); return; }
  save(); renderList();
}

function toggleCheck(idx) {
  getItems()[idx].checked = !getItems()[idx].checked;
  save(); renderList();
}

function clearAll() {
  if (!getItems().length) { toast(tx('tEmp'), 'i'); return; }
  if (!confirm(lang === 'hi' ? '‡§∏‡§≠‡•Ä ‡§Ü‡§á‡§ü‡§Æ ‡§π‡§ü‡§æ‡§è‡§Å?' : 'Clear all items?')) return;
  getCart().items = [];
  save(); renderTabs(); renderList();
  toast(tx('tClr'), 'i');
}

function manualAdd() {
  var inp = document.getElementById('manInp');
  var qInp = document.getElementById('manQty');
  var name = inp.value.trim();
  var qty = parseInt(qInp.value) || 1;
  if (name) {
    addItem(name, qty);
    inp.value = '';
    qInp.value = 1;
    inp.focus();
  }
}

// ============= EDIT =============
function openEdit(idx) {
  editingIdx = idx;
  document.getElementById('editName').value = getItems()[idx].name;
  document.getElementById('editQty').value = getItems()[idx].qty;
  document.getElementById('editOv').classList.add('open');
  setTimeout(function() { document.getElementById('editName').focus(); }, 100);
}

function closeEdit() {
  editingIdx = -1;
  document.getElementById('editOv').classList.remove('open');
}

function saveEdit() {
  if (editingIdx < 0) return;
  var n = document.getElementById('editName').value.trim();
  var q = parseInt(document.getElementById('editQty').value) || 1;
  if (n) {
    getItems()[editingIdx].name = n;
    getItems()[editingIdx].qty = q;
    save(); renderList();
    toast('‚úèÔ∏è Updated!', 's');
  }
  closeEdit();
}

// ============= RENDER LIST =============
function renderList() {
  var items = getItems();
  var list = document.getElementById('listEl');
  var query = document.getElementById('searchInp').value.toLowerCase();

  if (!items.length) {
    list.innerHTML = '<div class="empty"><span class="e-icon">üåª</span><p>' + tx('empty') + '</p></div>';
    document.getElementById('sumCard').style.display = 'none';
    document.getElementById('countEl').textContent = '0';
    return;
  }

  var html = '';
  var shown = 0;
  for (var i = 0; i < items.length; i++) {
    var it = items[i];
    if (query && it.name.toLowerCase().indexOf(query) === -1) continue;
    shown++;
    html += '<li class="item' + (it.checked ? ' done' : '') + '">' +
      '<input type="checkbox" class="i-check"' + (it.checked ? ' checked' : '') + ' onchange="toggleCheck(' + i + ')">' +
      '<span class="i-num">' + shown + '</span>' +
      '<div class="i-info"><div class="i-name">' + escHtml(it.name) + '</div><div class="i-time">üïê ' + (it.time || '') + '</div></div>' +
      '<div class="i-qty"><button class="q-btn" onclick="changeQty(' + i + ',-1)">‚àí</button><span class="q-val">' + it.qty + '</span><button class="q-btn" onclick="changeQty(' + i + ',1)">+</button></div>' +
      '<div class="i-acts"><button class="a-btn a-edit" onclick="openEdit(' + i + ')">‚úèÔ∏è</button><button class="a-btn a-del" onclick="removeByIdx(' + i + ')">üóëÔ∏è</button></div>' +
      '</li>';
  }

  if (!shown && query) {
    html = '<div class="empty"><span class="e-icon">üîç</span><p>No match found</p></div>';
  }

  list.innerHTML = html;
  document.getElementById('countEl').textContent = items.length;

  // Summary
  var totalQty = 0, checked = 0;
  for (var i = 0; i < items.length; i++) {
    totalQty += items[i].qty;
    if (items[i].checked) checked++;
  }
  document.getElementById('sumCard').style.display = 'block';
  document.getElementById('sv1').textContent = items.length;
  document.getElementById('sv2').textContent = totalQty;
  document.getElementById('sv3').textContent = checked + '/' + items.length;
  document.getElementById('sv4').textContent = items.length - checked;
}

function escHtml(str) {
  var d = document.createElement('div');
  d.textContent = str;
  return d.innerHTML;
}

// ============= VOICE RECOGNITION =============
function setupRecognition() {
  var SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SR) {
    document.getElementById('vStatus').textContent = tx('noSp');
    document.getElementById('micBtn').style.opacity = 0.4;
    document.getElementById('micBtn').disabled = true;
    return null;
  }

  var rec = new SR();
  rec.continuous = false;
  rec.interimResults = true;
  rec.maxAlternatives = 3;
  rec.lang = 'en-IN';

  rec.onstart = function() {
    isListening = true;
    document.getElementById('micBtn').classList.add('active');
    document.getElementById('micRing').classList.add('pulse');
    document.getElementById('vStatus').textContent = tx('lis');
    document.getElementById('vStatus').classList.add('on');
  };

  rec.onresult = function(event) {
    var final = '';
    var interim = '';
    for (var i = event.resultIndex; i < event.results.length; i++) {
      var t = event.results[i][0].transcript;
      if (event.results[i].isFinal) {
        final += t;
      } else {
        interim += t;
      }
    }
    var display = final || interim;
    document.getElementById('vTranscript').textContent = '"' + display + '"';
    if (final) {
      processVoice(final.trim());
    }
  };

  rec.onerror = function(event) {
    console.log('Speech error:', event.error);
    stopMic();
    if (event.error === 'no-speech') {
      toast(lang === 'hi' ? '‡§ï‡•ã‡§à ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§®‡§π‡•Ä‡§Ç ‡§∏‡•Å‡§®‡§æ‡§à ‡§¶‡•Ä' : 'No speech detected, try again', 'e');
    }
  };

  rec.onend = function() {
    stopMic();
  };

  return rec;
}

function toggleMic() {
  if (isListening) {
    if (recognition) recognition.stop();
    stopMic();
    return;
  }
  recognition = setupRecognition();
  if (recognition) {
    try { recognition.start(); } catch(e) { console.log('Mic error:', e); }
  }
}

function stopMic() {
  isListening = false;
  document.getElementById('micBtn').classList.remove('active');
  document.getElementById('micRing').classList.remove('pulse');
  document.getElementById('vStatus').textContent = tx('vTip');
  document.getElementById('vStatus').classList.remove('on');
}

// ============= PROCESS VOICE =============
function processVoice(raw) {
  var cmd = raw;
  var lower = cmd.toLowerCase();
  console.log('Voice heard:', cmd);

  // ---- CLEAR CART ----
  var clearPhrases = [
    'clear cart', 'clear all', 'empty cart', 'delete all', 'remove all', 'clear the cart',
    '‡§ï‡§æ‡§∞‡•ç‡§ü ‡§∏‡§æ‡§´ ‡§ï‡§∞‡•ã', '‡§ï‡§æ‡§∞‡•ç‡§ü ‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡•ã', '‡§∏‡§¨ ‡§π‡§ü‡§æ‡§ì', '‡§∏‡§æ‡§∞‡§æ ‡§π‡§ü‡§æ‡§ì', '‡§ï‡§æ‡§∞‡•ç‡§ü ‡§ñ‡§æ‡§≤‡•Ä ‡§ï‡§∞‡•ã',
    '‡§∏‡§¨ ‡§ï‡•Å‡§õ ‡§π‡§ü‡§æ‡§ì', '‡§™‡•Ç‡§∞‡§æ ‡§π‡§ü‡§æ‡§ì'
  ];
  for (var i = 0; i < clearPhrases.length; i++) {
    if (lower.indexOf(clearPhrases[i]) !== -1) {
      clearAll();
      return;
    }
  }

  // ---- REMOVE PATTERNS ----
  var itemName = null;

  // English: "remove X", "delete X", "remove the X"
  var enRemovePatterns = [
    /^remove\s+the\s+(.+)/i,
    /^remove\s+(.+)/i,
    /^delete\s+the\s+(.+)/i,
    /^delete\s+(.+)/i
  ];
  for (var i = 0; i < enRemovePatterns.length; i++) {
    var m = lower.match(enRemovePatterns[i]);
    if (m) {
      itemName = m[1].trim();
      // Get original casing from raw command
      var startPos = cmd.length - itemName.length;
      var originalItem = cmd.substring(startPos).trim();
      removeItem(originalItem || itemName);
      return;
    }
  }

  // Hindi: "X ‡§π‡§ü‡§æ‡§ì", "‡§π‡§ü‡§æ‡§ì X", "X ‡§®‡§ø‡§ï‡§æ‡§≤‡•ã", "X ‡§π‡§ü‡§æ ‡§¶‡•ã"
  var hiRemovePatterns = [
    /^‡§π‡§ü‡§æ‡§ì\s+(.+)/,
    /^‡§®‡§ø‡§ï‡§æ‡§≤‡•ã\s+(.+)/,
    /(.+?)\s+‡§π‡§ü‡§æ‡§ì$/,
    /(.+?)\s+‡§π‡§ü‡§æ\s*‡§¶‡•ã$/,
    /(.+?)\s+‡§®‡§ø‡§ï‡§æ‡§≤‡•ã$/,
    /(.+?)\s+‡§°‡§ø‡§≤‡•Ä‡§ü\s*‡§ï‡§∞‡•ã$/,
    /(.+?)\s+‡§∞‡§ø‡§Æ‡•Ç‡§µ\s*‡§ï‡§∞‡•ã$/
  ];
  for (var i = 0; i < hiRemovePatterns.length; i++) {
    var m = cmd.match(hiRemovePatterns[i]);
    if (m) {
      removeItem(m[1].trim());
      return;
    }
  }

  // ---- ADD PATTERNS ----
  // English: "add X", "add the X", "put X"
  var enAddPatterns = [
    /^add\s+the\s+(.+)/i,
    /^add\s+(.+)/i,
    /^put\s+the\s+(.+)/i,
    /^put\s+(.+)/i
  ];
  for (var i = 0; i < enAddPatterns.length; i++) {
    var m = lower.match(enAddPatterns[i]);
    if (m) {
      itemName = m[1].trim();
      var startPos = cmd.length - itemName.length;
      var originalItem = cmd.substring(startPos).trim();
      addItem(originalItem || itemName);
      return;
    }
  }

  // Hindi: "X ‡§ú‡•ã‡§°‡§º‡•ã", "‡§ú‡•ã‡§°‡§º‡•ã X", "X ‡§°‡§æ‡§≤‡•ã", "X ‡§ê‡§° ‡§ï‡§∞‡•ã"
  var hiAddPatterns = [
    /^‡§ú‡•ã‡§°‡§º‡•ã\s+(.+)/,
    /^‡§°‡§æ‡§≤‡•ã\s+(.+)/,
    /^‡§ê‡§°\s*‡§ï‡§∞‡•ã\s+(.+)/,
    /^‡§ú‡•ã‡§°‡§º\s*‡§¶‡•ã\s+(.+)/,
    /(.+?)\s+‡§ú‡•ã‡§°‡§º‡•ã$/,
    /(.+?)\s+‡§ú‡•ã‡§°‡§º\s*‡§¶‡•ã$/,
    /(.+?)\s+‡§°‡§æ‡§≤‡•ã$/,
    /(.+?)\s+‡§ê‡§°\s*‡§ï‡§∞‡•ã$/,
    /(.+?)\s+‡§°‡§æ‡§≤\s*‡§¶‡•ã$/
  ];
  for (var i = 0; i < hiAddPatterns.length; i++) {
    var m = cmd.match(hiAddPatterns[i]);
    if (m) {
      addItem(m[1].trim());
      return;
    }
  }

  // ---- NOTHING MATCHED ----
  // If no add/remove command detected, show a helpful toast but DO NOT add the item
  toast(lang === 'hi'
    ? '‚ö†Ô∏è "‡§ú‡•ã‡§°‡§º‡•ã" ‡§Ø‡§æ "‡§π‡§ü‡§æ‡§ì" ‡§¨‡•ã‡§≤‡•á‡§Ç ‚Äî ‡§ú‡•à‡§∏‡•á "‡§¶‡•Ç‡§ß ‡§ú‡•ã‡§°‡§º‡•ã"'
    : '‚ö†Ô∏è Say "Add" or "Remove" first ‚Äî e.g. "Add milk"', 'i');
}

// ============= EXPORT / SHARE =============
function copyList() {
  var items = getItems();
  if (!items.length) { toast(tx('tEmp'), 'i'); return; }
  var text = 'üåª ' + getCart().name + '\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n';
  for (var i = 0; i < items.length; i++) {
    var it = items[i];
    text += (it.checked ? '‚úÖ' : '‚¨ú') + ' ' + (i+1) + '. ' + it.name + ' (x' + it.qty + ')\n';
  }
  text += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nTotal: ' + items.length + ' items';

  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(text).then(function() {
      toast(tx('tCp'), 's');
    }).catch(function() {
      fallbackCopy(text);
    });
  } else {
    fallbackCopy(text);
  }
}

function fallbackCopy(text) {
  var ta = document.createElement('textarea');
  ta.value = text;
  ta.style.position = 'fixed';
  ta.style.left = '-9999px';
  document.body.appendChild(ta);
  ta.select();
  try { document.execCommand('copy'); toast(tx('tCp'), 's'); }
  catch(e) { toast('Copy failed', 'e'); }
  document.body.removeChild(ta);
}

function shareList() {
  var items = getItems();
  if (!items.length) { toast(tx('tEmp'), 'i'); return; }
  var text = 'üåª ' + getCart().name + ':\n';
  for (var i = 0; i < items.length; i++) {
    text += (i+1) + '. ' + items[i].name + ' (x' + items[i].qty + ')\n';
  }
  if (navigator.share) {
    navigator.share({ title: 'üåª Cart', text: text }).catch(function() {});
  } else {
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(text).then(function() { toast(tx('tCp'), 's'); });
    } else {
      fallbackCopy(text);
    }
  }
}

// ============= KEYBOARD SHORTCUTS =============
document.addEventListener('keydown', function(e) {
  if (e.ctrlKey && e.shiftKey && (e.key === 'V' || e.key === 'v')) {
    e.preventDefault();
    toggleMic();
  }
  if (e.key === 'Escape') {
    closeEdit();
    document.getElementById('newOv').classList.remove('open');
  }
});

// ============= INITIALIZE =============
function init() {
  setLang(lang);
  renderTabs();
  renderList();
}

init();
</script>
</body>
</html>